<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <!-- Stylesheets -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- jQuery UI - assurez-vous d'inclure à la fois le JS et le CSS -->
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <!-- DataTables JS (Dépend de jQuery) -->
    <script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Leaflet JS (Pour les cartes) -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/newdash.css') }}">
    <style>
        .button {
            background-color:#df6565;/* Green background */
            border: none; /* No borders */
            color: white; /* White text */
            padding: 15px 32px; /* Padding around the text */
            text-align: center; /* Centered text */
            text-decoration: none; /* No underline */
            display: inline-block; /* Align on the same line */
            font-size: 16px; /* Larger font size */
            margin: 4px 2px; /* Some space around the button */
            cursor: pointer; /* Pointer cursor on hover */
            border-radius: 8px; /* Rounded corners */
            transition: background-color 0.3s; /* Smooth transition for hover effect */
        }
        .control-bar {
    position: fixed; /* Fixed position */
    bottom: 0; /* At the bottom of the page */
    width: 110%; /* Full width */
    background-color: #f1f1f1; /* Light grey background */
    padding: 10px 0; /* Padding around the content */
    text-align: center; /* Center the buttons */
    box-shadow: 0 -2px 5px rgba(0,0,0,0.3); /* Add shadow for better visibility */
}
       
.button:hover {
    background-color: #45a049; /* Darker green background on hover */
}

            body, html {
              
  background-color: #f0f2f5; /* Couleur de fond de la page */
}
#videoFeed {
    max-width: 100%;
    height: auto;
    aspect-ratio: 16 / 9; /* Définir le ratio selon vos besoins */
}


.drop-zone {
  border: 2px dashed #ccc;
  position: relative; /* Ou un autre positionnement approprié */
  top: 70px; /* Décalage de 50% vers le bas par rapport à son parent */
  left: 50%; /* Décalage de 50% vers la droite par rapport à son parent */
  transform: translate(-50%, -50%); 
  border-radius: 50px;
  width: 300px;
  height: 100px;
  padding: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 20px;
  cursor: pointer;
  transition: all 0.3s ease-in-out;
  background-image: linear-gradient(to right top, #df6565, #f6cece); /* Dégradé de fond */
  color: #fff; /* Couleur du texte */
}

.drop-zone:hover, .drop-zone.drop-zone--over {
  background-image: linear-gradient(to right bottom, #02ae25, #65dfc9); /* Dégradé de fond lors du survol */
  border-color: #65dfc9; /* Couleur de la bordure lors du survol */
}

/* Style pour le texte affiché dans la zone de drop pour améliorer la visibilité */
.drop-zone p {
  margin: 0;
  font-size: 16px;
  font-weight: bold;
}







.video-container h1, .data-table h2 {
        text-align: center; /* Centrage des titres */
        padding: 15px;
        padding-left: 100px; /* Padding plus généreux pour un meilleur look */
        color: #ffffff; /* Couleur de texte blanc pour un meilleur contraste */
        margin-top: 20px;
        margin-bottom: 20px;
        border-radius: 10px; /* Bords plus arrondis */
        box-shadow: 0 4px 6px rgba(0,0,0,0.1); /* Ombre légère pour un effet 3D subtil */
    }
.video-container h1 {
        background: linear-gradient(to right top, #df6565, #f6cece); /* Dégradé pour le titre principal */
        font-size: 26px; /* Taille de police plus grande */
        font-style: italic;
    }

    .data-table h2 {
        background: linear-gradient(45deg, #6c7c7b, #ffffff); /* Dégradé pour le sous-titre */
        font-size: 26px;
        font-style: italic;
    }

.content {
    display: flex;
    align-items: start; /* Aligner les éléments en haut */
    justify-content: space-around; /* Espacement autour des éléments */
    padding-left: 100px;
    
}

.video-container, .data-table {
    flex: 1; /* Chaque conteneur prend une part égale de l'espace */
    margin: 0px;
    padding: 15px;
}

.data-table table {
    width: 98%; /* La table utilise toute la largeur du conteneur */
    border-collapse: collapse;
}

.data-table th, .data-table td {
    border: 1px solid #5d5d5d; /* Bordure pour les cellules */
    padding: 8px;
    text-align: left;
}

.data-table th {
    background-color: #ff2020; /* Couleur de fond pour les en-têtes */
}

.chart-title1 {
    font-size: 25px;
    font-style: bold;
    font-style: italic;
    text-align: center;
    padding-top: 50px;

}


    </style>
</head>
<body>
    <div class="wrapper">
        <nav class="sidebar">
            <div class="sidebar-header">
                <img src="{{ url_for('static', filename='images/Arriere-plan.png') }}" alt="TotalEnergies" class="logo">
            </div>
            <ul class="sidebar-menu">
                <li class="sidebar-item active"><a href="{{ url_for('dashboard') }}"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                <li class="sidebar-item"><a href="{{ url_for('charts_jour') }}"><i class="fas fa-chart-bar"></i> Statistiques</a></li>
                <li class="sidebar-item"><a href="{{ url_for('DragAndDrop') }}"><i class="fas fa-upload"></i> Upload Data</a></li>
                <li class="sidebar-item"><a href="{{ url_for('dashboard') }}"><i class="fas fa-coffee"></i> Coffe shop</a></li>
                <li class="sidebar-item"><a href="{{ url_for('dashboard') }}"><i class="fas fa-map"></i> Total Zone</a></li>
                <li class="sidebar-item"><a href="{{ url_for('data_table') }}"><i class="fas fa-map-marked-alt"></i> Maps</a></li>
                <li class="sidebar-item"><a href="{{ url_for('ajoutUser') }}"><i class="fas fa-map-marked-alt"></i> Gestion D'utilisateurs</a></li>
            </ul>
        </nav>
        <div class="main-content">
            <header class="header">
                <div class="header-content">
                    <h1>DASHBOARD</h1>
                    <p>ANALYSE DES DONNEES</p>
                </div>
                <div class="station-title" id="station-title">
                    <!-- Le titre mis à jour apparaîtra ici -->
                </div>
                <div class="header-icons">
                    <i class="fas fa-bell"></i>
                    <div class="profile-pic">
                        <img src="{{ url_for('static', filename='images/Calque2.png') }}" alt="Profile">
                    </div>
                </div>
            </header>
            <div class="content">
                <div class="top-container">
                    <div class="dropdown-container">
                        <div class="dropdown-group">
                            <label for="governorate">GOUVERNORAT</label>
                            <select id="governorate" name="governorate" onchange="updateTitle()">
                                <option value="Grand Tunis">GRAND TUNIS</option>
                                <option value="Ariana">ARIANA</option>
                                <option value="Bizerte">BIZERTE</option>
                                <!-- Ajoutez d'autres options ici -->
                            </select>
                        </div>
                        <div class="dropdown-group">
                            <label for="station-id">ID STATION</label>
                            <select id="station-id" name="station-id" onchange="updateTitle()">
                                <option value="Total N9-03">TOTAL N9-03</option>
                                <option value="Total N8-01">TOTAL N8-01</option>
                                <option value="Total S5-04">TOTAL S5-04</option>
                                <!-- Ajoutez d'autres options ici -->
                            </select>
                        </div>
                    </div>
                </div>




                <div class="chart-container1">
                    <h2 class="chart-title1">Upload de vidéo </h2>
                    <div id="file-drop-zone" class="drop-zone">
                        Glissez et déposez des fichiers ici ou cliquez pour sélectionner des fichiers
                        <input type="file" id="file-input" multiple style="display: none;" />
                    </div>
                </div>      
        
                
           
        <div class="content">
            <div class="video-container">
                <h1>Video Stream with YOLO Detection</h1>
                <img id="videoFeed" src="">
        
        
            </div>
            <div class="data-table">
                <h2>Détails des Véhicules</h2>
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Classe</th>
                            <th>Matricule</th>
                            <th>Score</th>
                            <th>DateEntrée</th>
                            <th>DateSortie</th>
                            <th>waitTime</th>
                            <th>Zone</th>
                        </tr>
                    </thead>
                    <tbody id="vehicleDetails"></tbody>
                </table>
            </div>
        </div>
        
                  
            <div class="control-bar">
              <button class="button" onclick="startVideo()">Start Video</button>
              <button class="button" onclick="stopVideo()">Stop Video</button>
              <button class="button" >Télécharger rapport </button>
          </div>
        
          <!--<img id="videoFeed" src="">-->
            <!-- <img src="{{ url_for('video_feed') }}" class="video-stream" alt="Video feed"> -->
                
                









    <script>

        
function updateTitle() {
    var governorate = document.getElementById('governorate').value;
    var stationId = document.getElementById('station-id').value;
    var titleElement = document.getElementById('station-title');
    titleElement.textContent = `${governorate} / ${stationId}`;
}
// Initialise le titre avec les valeurs par défaut
updateTitle();


    
document.addEventListener('DOMContentLoaded', (event) => {
  const dropZone = document.getElementById('file-drop-zone');
  const fileInput = document.getElementById('file-input');

  dropZone.addEventListener('click', () => {
    fileInput.click();
  });

  fileInput.addEventListener('change', (event) => {
    handleFiles(event.target.files);
  });

  dropZone.addEventListener('dragover', (event) => {
    event.preventDefault();
    dropZone.classList.add('drop-zone--over');
  });

  dropZone.addEventListener('dragleave', (event) => {
    dropZone.classList.remove('drop-zone--over');
  });

  dropZone.addEventListener('drop', (event) => {
    event.preventDefault();
    dropZone.classList.remove('drop-zone--over');
    const files = event.dataTransfer.files;
    handleFiles(files);
  });

  function handleFiles(files) {
    const url = '/upload'; // L'URL du serveur où les fichiers doivent être envoyés
    for (const file of files) {
        const formData = new FormData();
        formData.append('file', file); // Créer un objet FormData et ajouter le fichier

        // Envoyer le fichier au serveur avec une requête POST
        fetch(url, {
            method: 'POST',
            body: formData,
        })
        .then(response => response.json())
        .then(data => {
            console.log('Upload successful', data);
            // Vous pourriez ici lancer le traitement du fichier ou afficher un message de succès
        })
        .catch(error => {
            console.error('Error uploading file:', error);
        });

        console.log('Fichier envoyé pour upload :', file.name);
    }
}

});



   


        function startVideo() {
            var img = document.getElementById('videoFeed');
            img.src = "{{ url_for('video_feed') }}";
        }

        function stopVideo() {
            var img = document.getElementById('videoFeed');
            img.src = "";
        }



        
       
document.addEventListener('DOMContentLoaded', function () {
    // Connect to the WebSocket server
    const socket = io.connect(window.location.origin);
    console.log("Connected to WebSocket server."); // Log connection

    // Listen for 'new_data' events from the server
    socket.on('new_data', function (data) {
        console.log("Received new data from server:", data); // Log received data
        updateTable(data.data); // Update the table with new data
    });

    // Function to update the table with details from the server
    function updateTable(details) {
        console.log("Updating table with new vehicle details."); // Log the update process
        const tableBody = document.getElementById('vehicleDetails'); // Access the table body
        tableBody.innerHTML = ''; // Clear previous entries

        details.forEach(detail => {
            const row = tableBody.insertRow(); // Insert a new row in the table
            Object.values(detail).forEach(text => {
                const cell = row.insertCell(); // Insert a new cell in the row
                cell.textContent = text; // Add text to the cell
            });
        });
        console.log("Table updated successfully."); // Log successful update
    }
});















    </script>
    
</body>
</html>
