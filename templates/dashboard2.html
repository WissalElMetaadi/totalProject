<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dash.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.js"></script>
</head>
<body>
    <div class="sidebar">
        <h2>Profil Admin</h2>
        <img src="{{ url_for('static', filename='images/admin.png') }}" alt="Profile Picture" width="100" height="100">
        <h3>Nom et Prénom</h3>
        <ul>
            <!-- List of Dashboard Links -->
            <li><i class="fas fa-home"></i><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
            <li><i class="fas fa-chart-bar"></i><a href="{{ url_for('charts_jour') }}">Charts</a></li>
            <li><i class="fas fa-table"></i><a href="{{ url_for('data_table') }}">Tables</a></li>
            <li><i class="fas fa-map-marker-alt"></i><a href="{{ url_for('maps') }}">Maps</a></li>
            <li><i class="fas fa-puzzle-piece"></i><a href="{{ url_for('DragAndDrop') }}">Upload Data</a></li>
            <li><i class="fas fa-calendar-alt"></i><a href="#">Total Coffe Shop</a></li>
            <li><i class="fas fa-th"></i><a href="{{ url_for('total_zone') }}">Total Zones</a></li>
            <li><i class="fas fa-edit"></i><a href="#">Rapports</a></li>
            <li><i class="fas fa-copy"></i><a href="{{ url_for('ajoutUser') }}">Gestion d'utilisateurs</a></li>
            <li><i class="fas fa-book"></i><a href="#">Parametres</a></li>
        </ul>
    </div>

    <div class="main-content">
        <header class="header">
            <div class="breadcrumbs">Pages / Dashboard</div>
            <div><input type="text" class="search-box" placeholder="Type here..."></div>
            <div class="actions">
                <button class="button">ONLINE BUILDER</button>
                <div class="icon"><i class="far fa-star"></i><span>Star</span><span>10,873</span></div>
                <div class="icon"><i class="fas fa-cog"></i></div>
                <div class="icon"><i class="fas fa-user"></i><a href="{{ url_for('logout') }}" class="button">Log Out</a></div>
            </div>
        </header>
        
        <!-- Chart Containers -->
        <div class="chart-container-group">
            <!-- Bar Chart Card -->
            <div class="chart-card pink-gradient">
                <canvas id="barChart"></canvas>
                <h3 class="chart-title">Website Views</h3>
                <p class="chart-subtitle">Last Campaign Performance</p>
            </div>
            
            <!-- Line Chart Card -->
            <div class="chart-card green-gradient">
                <canvas id="lineChart"></canvas>
                <h3 class="chart-title">Daily Sales</h3>
                <p class="chart-subtitle">+15% increase in today sales.</p>
            </div>

            <!-- Dark Theme Line Chart Card -->
            <div class="chart-card gray-gradient">
                <canvas id="lineChartDark"></canvas>
                <h3 class="chart-title">Completed Tasks</h3>
                <p class="chart-subtitle">Last Campaign Performance</p>
            </div>
        </div>

        <!-- Data Table Section -->
        <section class="data-table">
            <h1>Datatables.net</h1>
            <table id="example" class="display">
                <thead>
                    <tr>
                        <th>track_id</th>
                        <th>class</th>
                        <th>license_plate_text</th>
                        <th>score LP</th>
                        <th>pompes_info</th>
                        <th>date d'entrée</th>
                        <th>date de sortie</th>
                        <th>wait_time</th>
                        <th>Image du véhicule</th>
                        <th>Image de la plaque</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in data %}
                    <tr>
                        <td><a href="#" class="track-info" data-track-id="{{ row['track_id'] }}">{{ row['track_id'] }}</a></td>
                        <td>{{ row['class'] }}</td>
                        <td>{{ row['license_plate_text'] }}</td>
                        <td>{{ row['score LP'] }}</td>
                        <td>{{ row['pompes_info'] }}</td>
                        <td>{{ row['date d\'entrée'] }}</td>
                        <td>{{ row['date de sortie'] }}</td>
                    <td>{{ row['wait_time'] }}</td>
                        <td><a href="#">Voir Image du véhicule</a></td>
                        <td><a href="#">Voir Image de la plaque</a></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>
        
        <!-- Details Modal -->
        <div id="detailsModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Détails de la Piste</h2>
                <div class="modal-body">
                    <div class="modal-info">
                        <p><b>Track ID:</b> <span id="modalTrackId"></span></p>
                        <p><b>Class:</b> <span id="modalClass"></span></p>
                        <p><b>LP Text:</b> <span id="modalLPText"></span></p>
                        <p><b>Score LP:</b> <span id="modalScoreLP"></span></p>
                        <p><b>Date d'entrée:</b> <span id="modalEntryDate"></span></p>
                        <p><b>Date de sortie:</b> <span id="modalExitDate"></span></p>
                        <p><b>Wait Time:</b> <span id="modalWaitTime"></span></p>
                    </div>
                    <div class="modal-images">
                        <p><b>Image du véhicule:</b></p>
                        <img id="modalCarImage" src="" alt="Image du véhicule" style="max-width:100%; height:auto;">
                        <p><b>Image de la plaque:</b></p>
                        <img id="modalPlateImage" src="" alt="Image de la plaque" style="max-width:100%; height:auto;">
                    </div>
                </div>
            </div>
        </div>

    </div>
    <!-- Scripts -->
    <script >$(document).ready(function() {
        // Initialize DataTable
        $('#example').DataTable();
    
        // Open image in a new window
        window.openImageWindow = function(url) {
            var newWindow = window.open(url, 'ImagePopup', 'width=600,height=400');
            if (!newWindow) alert('La fenêtre popup a été bloquée par le navigateur.');
        };
    
        // Handle click on track info links
        $('#example tbody').on('click', 'td a.track-info', function(e) {
            e.preventDefault();
            var tr = $(this).closest('tr');
            var data = tr.find('td').map(function(index, td) {
                return $(td).text();
            }).get();
            
            // Fill and display the modal
            $('#modalTrackId').text(data[0]);
            $('#modalClass').text(data[1]);
            $('#modalLPText').text(data[2]);
            $('#modalScoreLP').text(data[3]);
            $('#modalEntryDate').text(data[5]);
            $('#modalExitDate').text(data[6]);
            $('#modalWaitTime').text(data[7]);
            $('#detailsModal').show();
        });
    
        // Close modal on click of 'x' or outside modal
        $('.close').on('click', function() {
            $('#detailsModal').hide();
        });
    
        $(window).on('click', function(event) {
            if ($(event.target).hasClass('modal')) {
                $('#detailsModal').hide();
            }
        });
    });
    
    // Chart configurations here (if any)
    </script>
</body>
</html>
